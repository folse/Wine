{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}

{% block title %}Management{% endblock %}

{% block head %}
{{ super() }}
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar.css') }}">
{% endblock %}

{% block page_content %}

<div class="header clearfix">
    <nav>
      <ul class="nav nav-pills pull-right">
        <a id="export_btn" class="btn btn-lg btn-default" type="button">Export</a>
      </ul>
    </nav>
    <h3 class="text-muted">Export Data</h3>
</div>

<!-- <div class="select">
  <select name="select" id="category_select" class="category_select">
    <option value="选择品牌">Rot wine</option>
    <option value="选择品牌1">选择品牌1</option>
    <option value="选择品牌2">选择品牌2</option>
  </select>
</div> -->

<div class="select_date">
  <input type="text" id="start_date" class="calendar_input" placeholder="Start Date"> &nbsp;to&nbsp; 
  <div id="start_calendar"></div>
</div>
<div class="select_date">
  <input type="text" id="end_date" class="calendar_input" placeholder="End Date">
  <div id="end_calendar"></div>
</div>

<script src="{{ url_for('static', filename='js/jquery.js') }}"></script> 
<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
<script src="{{ url_for('static', filename='js/time.js') }}"></script> 
<script type="text/javascript">
    var start_date = ""
    var end_date = ""
    $('#start_calendar').calendar({
      width: 320,
      height: 320,
      trigger: '#start_date',
      zIndex: 999,
      format: 'yyyy-mm-dd',
        onSelected: function (view, date, data) {
            console.log('event: onSelected')
        },
        onClose: function (view, date, data) {
            console.log('event: onClose')
            console.log('view:' + view)
            console.log('date:' + date)
            console.log('data:' + (data || 'None'));
            start_date = formatDate(date, "yyyy-MM-dd")
        }
    });
    $('#end_calendar').calendar({
      width: 320,
      height: 320,
      trigger: '#end_date',
      zIndex: 999,
      format: 'yyyy-mm-dd',
        onSelected: function (view, date, data) {
            console.log('event: onSelected')
        },
        onClose: function (view, date, data) {
            console.log('event: onClose')
            console.log('view:' + view)
            console.log('date:' + date)
            console.log('data:' + (data || 'None'));
            end_date = formatDate(date, "yyyy-MM-dd")
        }
    });
    /*function download_excel() {
      
      $.ajax({
          type: "get",
          dataType: "json",
          url: "download_excel?type="+type,
          success: function (msg) {
            console.log(msg)
          }
      });
    }*/
    $(function () {
      $("#export_btn").click(function () {
        if (start_date != "" && end_date != "") {
          document.getElementById("export_btn").innerHTML = "Generating..."
          $.ajax({
            type: "post",
            dataType: "json",
            timeout: 60*10,
            url: "export_excel?start_date="+start_date+"&end_date="+end_date,
            complete: function (msg) {
              var type = 'inventory'
              window.location.href="/download_excel?type="+type;
              document.getElementById("export_btn").innerHTML = "Finish"
            }
          });
        }else{
          alert("Please select the date");
        }
      });
    });
</script>
{% endblock %}

{% block scripts %}
{{ super() }}

{% endblock %}
